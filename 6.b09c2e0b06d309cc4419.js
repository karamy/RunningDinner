(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"9B5/":function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r("yzu5");var n=function(){function e(e){this.paramsService=e}return e.prototype.ngOnInit=function(){},e.prototype.getIconName=function(){return this.paramsService.getParams().groupId?"people-outline":"person-circle-outline"},e}()},L0Zc:function(e,t,r){"use strict";var n=r("CcnG"),i=r("MKJQ"),s=r("jy/b"),o=r("ZYCi"),a=r("Ip0R");r("9B5/"),r("yzu5"),r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return c}));var u=n["ɵcrt"]({encapsulation:0,styles:[[""]],data:{}});function c(e){return n["ɵvid"](0,[(e()(),n["ɵeld"](0,0,null,null,5,"ion-button",[["routerLink","/home/profile"]],null,[[null,"click"]],(function(e,t,r){var i=!0;return"click"===t&&(i=!1!==n["ɵnov"](e,2).onClick()&&i),"click"===t&&(i=!1!==n["ɵnov"](e,3).onClick(r)&&i),i}),i.Q,i.d)),n["ɵdid"](1,49152,null,0,s.j,[n.ChangeDetectorRef,n.ElementRef,n.NgZone],null,null),n["ɵdid"](2,16384,null,0,o.o,[o.n,o.a,[8,null],n.Renderer2,n.ElementRef],{routerLink:[0,"routerLink"]},null),n["ɵdid"](3,737280,null,0,s.Hb,[a.LocationStrategy,s.Eb,n.ElementRef,o.n,[2,o.o]],null,null),(e()(),n["ɵeld"](4,0,null,0,1,"ion-icon",[["slot","icon-only"]],null,null,null,i.cb,i.p)),n["ɵdid"](5,49152,null,0,s.B,[n.ChangeDetectorRef,n.ElementRef,n.NgZone],{name:[0,"name"]},null)],(function(e,t){var r=t.component;e(t,2,0,"/home/profile"),e(t,3,0),e(t,5,0,r.getIconName())}),null)}},rrMi:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r("mrSG"),i=r("BV2u"),s=r("DP//"),o=r("1TA9"),a=(r("flHr"),r("qXBG")),u=r("07Uz"),c=r("yzu5"),d=r("0+Dt"),p=r("CcnG"),g=r("t/Na"),l=function(){function e(e,t,r,n,i,s,o,a){this.http=e,this.rdConstants=t,this.spinner=r,this.authService=n,this.profileService=i,this.paramsService=s,this.foodAllergiesService=o,this.badgesService=a,this.geocoder=new google.maps.Geocoder,this.dinnerTypes=[{code:1,description:"Italiano",dishes:["Antipasto","Primo","Secondo"]},{code:2,description:"Pesce",dishes:["Antipasto","Primo","Secondo"]},{code:3,description:"Vegan",dishes:["Antipasto","Primo","Secondo"]},{code:4,description:"Sushi",dishes:["Primo piatto","Secondo piatto","Terzo piatto"]}],this.directionsService=new google.maps.DirectionsService}return e.prototype.createDinner=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.spinner.create()];case 1:return r.sent(),[2,this.http.post(this.rdConstants.getApiRoute("dinners"),e).toPromise().finally((function(){t.spinner.dismiss()}))]}}))}))},e.prototype.getDinners=function(){return n.__awaiter(this,void 0,void 0,(function(){var e=this;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,this.spinner.create()];case 1:return t.sent(),[2,this.http.get(this.rdConstants.getApiRoute("dinners")).toPromise().finally((function(){e.spinner.dismiss()}))]}}))}))},e.prototype.leaveDinner=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.spinner.create()];case 1:return r.sent(),[2,this.http.post(this.rdConstants.getApiRoute("leaveDinner"),e).toPromise().finally((function(){t.spinner.dismiss()}))]}}))}))},e.prototype.getDinnerState=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.spinner.create()];case 1:return r.sent(),[2,new Promise((function(r,n){return t.http.post(t.rdConstants.getApiRoute("getDinnerState"),{dinnerId:e}).toPromise().then((function(e){r(e)}),(function(){n()})).finally((function(){t.spinner.dismiss()}))}))]}}))}))},e.prototype.getDinnerDetails=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,s,o=this;return n.__generator(this,(function(n){switch(n.label){case 0:return t=e.id,r=this.paramsService.getParams().groupId?this.profileService.getPartner().group_address:this.authService.getUserData().address,i=this.paramsService.getParams().groupId,s={dinnerId:t,userAddress:r,userGroupId:i},[4,this.spinner.create()];case 1:return n.sent(),[2,new Promise((function(e,t){return o.http.post(o.rdConstants.getApiRoute("getDinnerDetails"),s).toPromise().then((function(t){var r=t.avgDistance,n=t.dinnerData,i=o.getDinnerBadges(t),s=o.foodAllergiesService.convertImagesToJpeg(t.foodAllergies),a=o.getDinnerFoodAllergies(t),u=o.getDinnerUsersData(t);o._usersData=o.convertUserImagesToJpeg(t);for(var c,d={groupid:[],addresses:[]},p=0;p<o._usersData.length;p++)!1===d.groupid.includes(o._usersData[p].groupid)&&o._usersData[p].groupid!==o.paramsService.getParams().groupId&&(d.addresses.push(o._usersData[p].group_address),d.groupid.push(o._usersData[p].groupid));c=o.paramsService.getParams().groupId?o.profileService.getPartner().group_address:o.authService.getUser().userData.address,o.getCoordinates(d.addresses,c).then((function(t){e({usersData:o._usersData,badges:i,allFoodAllergies:s,foodAllergies:a[0],foodAllergiesCategories:a[1],minMaxAges:u,addressesLatLng:t[0],userLatLng:t[1],groupAddresses:d,dinnerData:n,avgDistance:r})}))}),(function(){t()})).finally((function(){o.spinner.dismiss()}))}))]}}))}))},e.prototype.getMyDinnerDetails=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i=this;return n.__generator(this,(function(n){switch(n.label){case 0:return r={dinnerId:e.id,groupId:t},[4,this.spinner.create()];case 1:return n.sent(),[2,new Promise((function(e,t){return i.http.post(i.rdConstants.getApiRoute("getDinnerHouses"),r).toPromise().then((function(t){var r={houses:t,myDish:void 0,houseDistances:[],foodAllergies:[],addressesLatLng:[]};r.houses=i.convertHouseImagesToJpeg(r.houses);var n=i.detAddressesToDecode(r.houses);i.getCoordinates(n,i.profileService.getPartner().group_address).then((function(t){r.addressesLatLng=t[0],i.getHouseDistances(r.houses).then((function(t){r.houseDistances=t,e(r)}))}))}),(function(){t()})).finally((function(){i.spinner.dismiss()}))}))]}}))}))},e.prototype.getDinnerBadges=function(e){var t=[];return e.badges.forEach((function(e){var r=t.filter((function(t){return t.group_id===e.group_id}));if(r){var n=r.find((function(t){return t.badge_id===e.badge_id}));n?n.progress<e.progress&&(n.progress=e.progress,n.description=e.description,n.badge_photo=e.badge_photo):t.push(e)}else t.push(e)})),this.badgesService.convertImagesToJpeg(t),this.badgesService.setDescriptionProgress(t),t},e.prototype.removeFoodAllergiesDuplicates=function(e){var t=[];return e.forEach((function(e){var r=t.filter((function(t){return t.allergy_id===e.allergy_id}));r&&r.find((function(t){return t.allergy_name.toLowerCase()===e.allergy_name.toLowerCase()}))||t.push(e)})),t},e.prototype.getDinnerFoodAllergies=function(e){var t=this.removeFoodAllergiesDuplicates(e.foodAllergies);return[t,this.foodAllergiesService.createCategoryArray(t)]},e.prototype.getDinnerUsersData=function(e){var t=this,r=[];return e.usersData.forEach((function(e){e.birth_date=new Date(e.birth_date),e.birth_date=e.birth_date.toLocaleDateString(),r.push(t.calcAge(e.birth_date))})),[Math.min.apply(null,r),Math.max.apply(null,r)]},e.prototype.convertHouseImagesToJpeg=function(e){return e.firstHouse.firstImage="data:image/jpeg;base64,"+e.firstHouse.firstImage,e.firstHouse.secondImage="data:image/jpeg;base64,"+e.firstHouse.secondImage,e.secondHouse.firstImage="data:image/jpeg;base64,"+e.secondHouse.firstImage,e.secondHouse.secondImage="data:image/jpeg;base64,"+e.secondHouse.secondImage,e.thirdHouse.firstImage="data:image/jpeg;base64,"+e.thirdHouse.firstImage,e.thirdHouse.secondImage="data:image/jpeg;base64,"+e.thirdHouse.secondImage,e},e.prototype.detAddressesToDecode=function(e){var t=[];return e.firstHouse.groupid!==this.paramsService.getParams().groupId&&t.push(e.firstHouse.groupAddress),e.secondHouse.groupid!==this.paramsService.getParams().groupId&&t.push(e.secondHouse.groupAddress),e.thirdHouse.groupid!==this.paramsService.getParams().groupId&&t.push(e.thirdHouse.groupAddress),t},e.prototype.getMyDinnerFoodAllergies=function(e,t){for(var r=[],n=[e.firstHouse.firstUserId,e.firstHouse.secondUserId,e.secondHouse.firstUserId,e.secondHouse.secondUserId,e.thirdHouse.firstUserId,e.thirdHouse.secondUserId],i=0;i<t.length;i++)for(var s=0;s<n.length;s++)t[i].user_id===n[s]&&r.push(t[i]);var o=this.removeFoodAllergiesDuplicates(r);return[o,this.foodAllergiesService.createCategoryArray(o)]},e.prototype.setDinnerDishes=function(e){var t=this.decodeType(Number(e.type)),r=new Date(e.date),n=t[1],i=new Date(r.getTime()),s=new Date(i.getTime()+21e5),o=t[2],a=new Date(s.getTime()+15e5),u=new Date(a.getTime()+21e5),c=t[3],d=new Date(u.getTime()+15e5),p=new Date(d.getTime()+24e5);return[{name:n,startTime:i,endTime:s},{name:o,startTime:a,endTime:u},{name:c,startTime:d,endTime:p}]},e.prototype.getDinnerTypes=function(){return this.dinnerTypes},e.prototype.decodeType=function(e){for(var t=0;t<this.dinnerTypes.length;t++)if(this.dinnerTypes[t].code===e)return[this.dinnerTypes[t].description,this.dinnerTypes[t].dishes[0],this.dinnerTypes[t].dishes[1],this.dinnerTypes[t].dishes[2]]},e.prototype.detMyDish=function(e,t,r,n){return this.paramsService.getParams().groupId===e.firstHouse.groupid?t:this.paramsService.getParams().groupId===e.secondHouse.groupid?r:n},e.prototype.setPhase=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.getDinnerState(e).then((function(e){var r=e.dinner_state;2===r?t=1:3===r?t=2:4===r?t=3:5===r&&(t=4)}))];case 1:return r.sent(),[2,t]}}))}))},e.prototype.setVariables=function(e,t){var r=this,i=[];return new Promise((function(s){return n.__awaiter(r,void 0,void 0,(function(){var r=this;return n.__generator(this,(function(o){switch(o.label){case 0:return[4,this.calcDistance(e,t).then((function(e){return n.__awaiter(r,void 0,void 0,(function(){return n.__generator(this,(function(t){return i.push("A "+e[0]+" da te","Tempo di viaggio stimato: "+e[1]+" in auto",e[2]),[2]}))}))}))];case 1:return o.sent(),s(i),[2]}}))}))}))},e.prototype.checkIfVoted=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.spinner.create()];case 1:return r.sent(),[2,new Promise((function(r,n){return t.http.post(t.rdConstants.getApiRoute("checkIfVoted"),{dinnerId:e}).toPromise().then((function(e){r(e)}),(function(){n()})).finally((function(){t.spinner.dismiss()}))}))]}}))}))},e.prototype.detGroupsToVote=function(e){var t=[];return e.houses.firstHouse.groupid!==this.paramsService.getParams().groupId&&t.push(e.houses.firstHouse),e.houses.secondHouse.groupid!==this.paramsService.getParams().groupId&&t.push(e.houses.secondHouse),e.houses.thirdHouse.groupid!==this.paramsService.getParams().groupId&&t.push(e.houses.thirdHouse),t},e.prototype.detVoteCategories=function(e){var t=[];switch(e){case 1:case 2:return t.push.apply(t,["Location","Bontà","Ospitalità","Simpatia","Complessità del piatto"]),t;case 3:return t.push.apply(t,["Location","Bontà","Ospitalità","Simpatia","Veganità"]),t;case 4:return t.push.apply(t,["Location","Bontà","Ospitalità","Simpatia","Sushitosità"]),t;default:return t.push.apply(t,["Location","Bontà","Ospitalità","Simpatia","Complessità del piatto"]),t}},e.prototype.postGroupVotes=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,s=this;return n.__generator(this,(function(n){switch(n.label){case 0:return i={groupsArray:e,votingGroupId:t,dinnerId:r},[4,this.spinner.create()];case 1:return n.sent(),[2,this.http.post(this.rdConstants.getApiRoute("insertDinnerVotes"),i).toPromise().then((function(){s.spinner.dismiss()}))]}}))}))},e.prototype.calcAge=function(e){var t=new Date,r=e.split("/"),n=new Date(r[2],r[1]-1,r[0]),i=t.getFullYear()-n.getFullYear(),s=t.getMonth()-n.getMonth();return(s<0||0===s&&t.getDate()<n.getDate())&&i--,i},e.prototype.formatDate=function(e){var t=("0"+(e=new Date(e)).getUTCHours()).slice(-2)+"."+("0"+e.getUTCMinutes()).slice(-2);return[["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"][e.getDay()]+" "+e.getDate()+" "+["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"][e.getMonth()]+" "+e.getFullYear(),t]},e.prototype.convertUserImagesToJpeg=function(e){for(var t=0;t<e.usersData.length;t++)e.usersData[t].profile_photo="data:image/jpeg;base64,"+e.usersData[t].profile_photo;return e.usersData},e.prototype.getCoordinates=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,s;return n.__generator(this,(function(n){switch(n.label){case 0:r=[],i=[],s=0,n.label=1;case 1:return s<e.length?[4,this.geocodeAddresses(e[s]).then((function(e){r.push(e)}),(function(){console.log("Errore in geocodeAddresses dinners")}))]:[3,4];case 2:n.sent(),n.label=3;case 3:return s++,[3,1];case 4:return[4,this.geocodeAddresses(t).then((function(e){i.push(e)}),(function(){console.log("Errore in geocodeAddresses user")}))];case 5:return n.sent(),[2,[r,i]]}}))}))},e.prototype.geocodeAddresses=function(e){var t=this;return new Promise((function(r,n){t.geocoder.geocode({address:e},(function(e,t){"OK"===t?r(e[0].geometry.location):(console.log("Impossibile eseguire geocoder per la seguente ragione: "+t),n())}))}))},e.prototype.getHouseDistances=function(e){var t=this;return new Promise((function(r,n){var i=[];t.calcDistance(e.firstHouse.groupAddress,e.secondHouse.groupAddress).then((function(n){i.push(n[0]),t.calcDistance(e.secondHouse.groupAddress,e.thirdHouse.groupAddress).then((function(e){i.push(e[0]),r(i)}))}))}))},e.prototype.getDinnerTimeLeft=function(e){var t=(new Date).getTime(),r=new Date(e).getTime()-t-72e5,n=Math.floor(r/864e5),i=Math.floor(r%864e5/36e5);return i<0&&(n++,i++),[n,i,Math.floor(r%36e5/6e4)]},e.prototype.joinDinner=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.spinner.create()];case 1:return r.sent(),[2,this.http.post(this.rdConstants.getApiRoute("joinDinner"),e).toPromise().finally((function(){t.spinner.dismiss()}))]}}))}))},e.prototype.updateDinner=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t=this;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.spinner.create()];case 1:return r.sent(),[2,this.http.put(this.rdConstants.getApiRoute("dinners"),e).toPromise().finally((function(){t.spinner.dismiss()}))]}}))}))},e.prototype.calcDistance=function(e,t){var r=this,n=new google.maps.DirectionsRenderer;return new Promise((function(i,s){r.directionsService.route({origin:e,destination:t,travelMode:google.maps.TravelMode.DRIVING},(function(e,t){if("OK"===t){var r=e.routes[0].legs[0].distance.text,o=e.routes[0].legs[0].duration.text;n.setDirections(e),i([r,o,n])}else window.alert("Directions request failed due to "+t),s()}))}))},e.prototype.checkIfExistingMarker=function(e,t){if(0!==e.length){for(var r=0;r<e.length;r++){var n=e[r].getPosition();if(t.equals(n)){var i=t.lat()+(Math.random()-.5)/1500,s=t.lng()+(Math.random()-.5)/1500;return new google.maps.LatLng(i,s)}}return t}return t},e.ngInjectableDef=p["ɵɵdefineInjectable"]({factory:function(){return new e(p["ɵɵinject"](g.c),p["ɵɵinject"](i.a),p["ɵɵinject"](s.a),p["ɵɵinject"](a.a),p["ɵɵinject"](d.a),p["ɵɵinject"](c.a),p["ɵɵinject"](u.a),p["ɵɵinject"](o.a))},token:e,providedIn:"root"}),e}()}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[99],{rrMi:function(n,e,t){"use strict";t.d(e,"a",(function(){return p}));var l=t("mrSG"),i=t("BV2u"),r=t("DP//"),o=t("1TA9"),u=t("qXBG"),a=t("ZYCi"),s=t("VnD/"),d=t("07Uz"),c=t("CcnG"),f=t("t/Na"),g=t("jy/b"),p=function(){function n(n,e,t,l,i,r,o,u){var a=this;this.http=n,this.router=e,this.platform=t,this.rdConstants=l,this.spinner=i,this.authService=r,this.foodAllergiesService=o,this.badgesService=u,this.hideTabBarPages=["dinner-detail"],this.geocoder=new google.maps.Geocoder,this.dinnerTypes=[{code:1,description:"Italiano"},{code:2,description:"Pesce"},{code:3,description:"Vegan"},{code:4,description:"Sushi"}],this.platform.ready().then((function(){a.navEvents()}))}return n.prototype.navEvents=function(){var n=this;this.router.events.pipe(Object(s.a)((function(n){return n instanceof a.d}))).subscribe((function(e){n.showHideTabs(e)}))},n.prototype.showHideTabs=function(n){var e=n.url.split("/"),t=e[e.length-1].split("?")[0];this.hideTabBarPages.indexOf(t)>-1?this.hideTabs():this.showTabs()},n.prototype.hideTabs=function(){var n=document.getElementById("myTabBar");"none"!==n.style.display&&(n.style.display="none")},n.prototype.showTabs=function(){var n=document.getElementById("myTabBar");"flex"!==n.style.display&&(n.style.display="flex")},n.prototype.createDinner=function(n){return l.__awaiter(this,void 0,void 0,(function(){var e=this;return l.__generator(this,(function(t){switch(t.label){case 0:return[4,this.spinner.create()];case 1:return t.sent(),[2,this.http.post(this.rdConstants.getApiRoute("dinners"),n).toPromise().finally((function(){e.spinner.dismiss()}))]}}))}))},n.prototype.getDinners=function(){return l.__awaiter(this,void 0,void 0,(function(){var n=this;return l.__generator(this,(function(e){switch(e.label){case 0:return[4,this.spinner.create()];case 1:return e.sent(),[2,this.http.get(this.rdConstants.getApiRoute("dinners")).toPromise().finally((function(){n.spinner.dismiss()}))]}}))}))},n.prototype.leaveDinner=function(n){return l.__awaiter(this,void 0,void 0,(function(){var e=this;return l.__generator(this,(function(t){switch(t.label){case 0:return[4,this.spinner.create()];case 1:return t.sent(),[2,this.http.post(this.rdConstants.getApiRoute("leaveDinner"),n).toPromise().finally((function(){e.spinner.dismiss()}))]}}))}))},n.prototype.getDinnerDetails=function(n){return l.__awaiter(this,void 0,void 0,(function(){var e,t,i,r,o=this;return l.__generator(this,(function(l){switch(l.label){case 0:return e=n.id,t=this.authService.getUserData().userid,i=this.authService.getUserData().address,r={dinnerId:e,userId:t,userAddress:i},[4,this.spinner.create()];case 1:return l.sent(),[2,new Promise((function(n,e){return o.http.post(o.rdConstants.getApiRoute("getDinnerDetails"),r).toPromise().then((function(e){var t=e.avgDistance,l=e.dinnerData,i=o.getDinnerBadges(e),r=o.getDinnerFoodAllergies(e),u=o.getDinnerUsersData(e);o.getCoordinates(e,o.authService.getUserData().address).then((function(e){n({badges:i,foodAllergies:r[0],foodAllergiesCategories:r[1],minMaxAges:u,addressesLatLng:e[0],userLatLng:e[1],avgDistance:t,dinnerData:l})}))}),(function(){e()})).finally((function(){o.spinner.dismiss()}))}))]}}))}))},n.prototype.getDinnerBadges=function(n){var e=[];return n.badges.forEach((function(n){var t=e.filter((function(e){return e.group_id===n.group_id}));if(t){var l=t.find((function(e){return e.badge_id===n.badge_id}));l?l.progress<n.progress&&(l.progress=n.progress,l.description=n.description,l.badge_photo=n.badge_photo):e.push(n)}else e.push(n)})),this.badgesService.convertImagesToJpeg(e),this.badgesService.setDescriptionProgress(e),e},n.prototype.getDinnerFoodAllergies=function(n){var e=[];n.foodAllergies.forEach((function(n){var t=e.filter((function(e){return e.allergy_id===n.allergy_id}));t&&t.find((function(e){return e.allergy_name.toLowerCase()===n.allergy_name.toLowerCase()}))||e.push(n)})),this.foodAllergiesService.convertImagesToJpeg(e),this.foodAllergiesService.orderFoodAllergies(e);var t=this.foodAllergiesService.createCategoryArray(e);return[e,t]},n.prototype.getDinnerUsersData=function(n){var e=this,t=[];return n.usersData.forEach((function(n){n.birth_date=new Date(n.birth_date),n.birth_date=n.birth_date.toLocaleDateString(),t.push(e.calcAge(n.birth_date))})),[Math.min.apply(null,t),Math.max.apply(null,t)]},n.prototype.getDinnerTypes=function(){return this.dinnerTypes},n.prototype.decodeType=function(n){for(var e=0;e<this.dinnerTypes.length;e++)if(this.dinnerTypes[e].code===n)return this.dinnerTypes[e].description},n.prototype.calcAge=function(n){var e=new Date,t=n.split("/"),l=new Date(t[2],t[1]-1,t[0]),i=e.getFullYear()-l.getFullYear(),r=e.getMonth()-l.getMonth();return(r<0||0===r&&e.getDate()<l.getDate())&&i--,i},n.prototype.formatDate=function(n){var e=("0"+(n=new Date(n)).getHours()).slice(-2)+"."+("0"+n.getMinutes()).slice(-2);return[["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"][n.getDay()]+" "+n.getDate()+" "+["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"][n.getMonth()]+" "+n.getFullYear(),e]},n.prototype.getCoordinates=function(n,e){return l.__awaiter(this,void 0,void 0,(function(){var t,i,r,o,u,a=this;return l.__generator(this,(function(s){switch(s.label){case 0:t=[],i=[],r=function(e){return l.__generator(this,(function(l){switch(l.label){case 0:return[4,o.geocodeAddresses(n.usersData[e].address).then((function(l){n.usersData[e].userId!==a.authService.getUserData().userid&&t.push(l)}),(function(){console.log("Errore in geocodeAddresses dinners")}))];case 1:return l.sent(),[2]}}))},o=this,u=0,s.label=1;case 1:return u<n.usersData.length?[5,r(u)]:[3,4];case 2:s.sent(),s.label=3;case 3:return u++,[3,1];case 4:return[4,this.geocodeAddresses(e).then((function(n){i.push(n)}),(function(){console.log("Errore in geocodeAddresses user")}))];case 5:return s.sent(),[2,[t,i]]}}))}))},n.prototype.geocodeAddresses=function(n){var e=this;return new Promise((function(t,l){e.geocoder.geocode({address:n},(function(n,e){"OK"===e?t(n[0].geometry.location):(console.log("Impossibile eseguire geocoder per la seguente ragione: "+e),l())}))}))},n.prototype.joinDinner=function(n){return l.__awaiter(this,void 0,void 0,(function(){var e=this;return l.__generator(this,(function(t){switch(t.label){case 0:return[4,this.spinner.create()];case 1:return t.sent(),[2,this.http.post(this.rdConstants.getApiRoute("joinDinner"),n).toPromise().finally((function(){e.spinner.dismiss()}))]}}))}))},n.prototype.updateDinner=function(n){return l.__awaiter(this,void 0,void 0,(function(){var e=this;return l.__generator(this,(function(t){switch(t.label){case 0:return[4,this.spinner.create()];case 1:return t.sent(),[2,this.http.put(this.rdConstants.getApiRoute("dinners"),n).toPromise().finally((function(){e.spinner.dismiss()}))]}}))}))},n.ngInjectableDef=c["ɵɵdefineInjectable"]({factory:function(){return new n(c["ɵɵinject"](f.c),c["ɵɵinject"](a.n),c["ɵɵinject"](g.Fb),c["ɵɵinject"](i.a),c["ɵɵinject"](r.a),c["ɵɵinject"](u.a),c["ɵɵinject"](d.a),c["ɵɵinject"](o.a))},token:n,providedIn:"root"}),n}()},zwlN:function(n,e,t){"use strict";t.r(e);var l=t("CcnG"),i=function(){return function(){}}(),r=t("pMnS"),o=t("MKJQ"),u=t("jy/b"),a=t("ZYCi"),s=t("Ip0R"),d=function(){function n(){}return n.prototype.ngOnInit=function(){},n}(),c=l["ɵcrt"]({encapsulation:0,styles:[["ion-card[_ngcontent-%COMP%]{background-color:#9cc7ae}"]],data:{}});function f(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,9,"ion-card",[],null,null,null,o.U,o.f)),l["ɵdid"](1,49152,null,0,u.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](2,0,null,0,4,"ion-card-header",[],null,null,null,o.S,o.h)),l["ɵdid"](3,49152,null,0,u.n,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](4,0,null,0,2,"ion-card-title",[],null,null,null,o.T,o.i)),l["ɵdid"](5,49152,null,0,u.p,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵted"](6,0,["",""])),(n()(),l["ɵeld"](7,0,null,0,2,"ion-card-content",[],null,null,null,o.R,o.g)),l["ɵdid"](8,49152,null,0,u.m,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵted"](9,0,[" "," "]))],null,(function(n,e){var t=e.component;n(e,6,0,t.dinner.title),n(e,9,0,t.dinner.description)}))}var g=function(){function n(){}return n.prototype.ngOnInit=function(){},n}(),p=l["ɵcrt"]({encapsulation:0,styles:[[""]],data:{}});function h(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,9,"ion-card",[],null,null,null,o.U,o.f)),l["ɵdid"](1,49152,null,0,u.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](2,0,null,0,4,"ion-card-header",[],null,null,null,o.S,o.h)),l["ɵdid"](3,49152,null,0,u.n,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](4,0,null,0,2,"ion-card-title",[],null,null,null,o.T,o.i)),l["ɵdid"](5,49152,null,0,u.p,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵted"](6,0,["",""])),(n()(),l["ɵeld"](7,0,null,0,2,"ion-card-content",[],null,null,null,o.R,o.g)),l["ɵdid"](8,49152,null,0,u.m,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵted"](9,0,[" "," "]))],null,(function(n,e){var t=e.component;n(e,6,0,t.dinner.title),n(e,9,0,t.dinner.description)}))}var m=t("L0Zc"),v=t("9B5/"),D=t("yzu5"),y=t("rrMi"),b=t("98RE"),R=function(){function n(n,e,t,l){this.paramsService=n,this.dinnersService=e,this.router=t,this.notificationsService=l}return n.prototype.ngOnInit=function(){var n=this;this.loadDinners(),this.notificationsService.getUpdateParamsObservable().subscribe((function(){console.log("Elenco cene - Ricarico cene"),n.loadDinners()}))},n.prototype.loadDinners=function(n){var e=this;this.dinnersService.getDinners().then((function(t){if(console.log(t),e.myDinner=t.myDinner,e.dinnerList=t.otherDinners,e.myDinner){var l=e.dinnersService.formatDate(e.myDinner.date);e.myDinner.dateString=l[0],e.myDinner.time=l[1]}for(var i=0;i<e.dinnerList.length;i++){var r=e.dinnersService.formatDate(e.dinnerList[i].date);e.dinnerList[i].dateString=r[0],e.dinnerList[i].time=r[1]}n&&n.target.complete()}),(function(n){console.warn(n)}))},n.prototype.goToDinnerDetail=function(n){this.router.navigate(["/home/tabs/dinners/dinner-detail"],{queryParams:n})},n}(),C=l["ɵcrt"]({encapsulation:0,styles:[[""]],data:{}});function _(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,5,"ion-button",[["routerLink","/home/tabs/dinners/create-dinner"]],null,[[null,"click"]],(function(n,e,t){var i=!0;return"click"===e&&(i=!1!==l["ɵnov"](n,2).onClick()&&i),"click"===e&&(i=!1!==l["ɵnov"](n,3).onClick(t)&&i),i}),o.P,o.d)),l["ɵdid"](1,49152,null,0,u.j,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),l["ɵdid"](2,16384,null,0,a.o,[a.n,a.a,[8,null],l.Renderer2,l.ElementRef],{routerLink:[0,"routerLink"]},null),l["ɵdid"](3,737280,null,0,u.Hb,[s.LocationStrategy,u.Eb,l.ElementRef,a.n,[2,a.o]],null,null),(n()(),l["ɵeld"](4,0,null,0,1,"ion-icon",[["name","add"],["slot","icon-only"]],null,null,null,o.bb,o.p)),l["ɵdid"](5,49152,null,0,u.B,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{name:[0,"name"]},null)],(function(n,e){n(e,2,0,"/home/tabs/dinners/create-dinner"),n(e,3,0),n(e,5,0,"add")}),null)}function w(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,3,"div",[],null,null,null,null,null)),(n()(),l["ɵeld"](1,0,null,null,2,"ion-card",[],null,null,null,o.U,o.f)),l["ɵdid"](2,49152,null,0,u.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵted"](-1,0,[" Scegli la tua prossima RunningDinner :D! "]))],null,null)}function I(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,2,"div",[],null,null,null,null,null)),(n()(),l["ɵeld"](1,0,null,null,1,"rd-my-dinner",[],null,[[null,"click"]],(function(n,e,t){var l=!0,i=n.component;return"click"===e&&(l=!1!==i.goToDinnerDetail(i.myDinner)&&l),l}),f,c)),l["ɵdid"](2,114688,null,0,d,[],{dinner:[0,"dinner"]},null)],(function(n,e){n(e,2,0,e.component.myDinner)}),null)}function E(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,2,"div",[],null,[[null,"click"]],(function(n,e,t){var l=!0;return"click"===e&&(l=!1!==n.component.goToDinnerDetail(n.context.$implicit)&&l),l}),null,null)),(n()(),l["ɵeld"](1,0,null,null,1,"rd-dinner",[],null,null,null,h,p)),l["ɵdid"](2,114688,null,0,g,[],{dinner:[0,"dinner"]},null)],(function(n,e){n(e,2,0,e.context.$implicit)}),null)}function N(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,3,"ion-list",[],null,null,null,o.jb,o.x)),l["ɵdid"](1,49152,null,0,u.N,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵand"](16777216,null,0,1,null,E)),l["ɵdid"](3,278528,null,0,s.NgForOf,[l.ViewContainerRef,l.TemplateRef,l.IterableDiffers],{ngForOf:[0,"ngForOf"]},null)],(function(n,e){n(e,3,0,e.component.dinnerList)}),null)}function S(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,3,"div",[],null,null,null,null,null)),(n()(),l["ɵeld"](1,0,null,null,2,"ion-card",[],null,null,null,o.U,o.f)),l["ɵdid"](2,49152,null,0,u.l,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵted"](-1,0,[" Non sono presenti cene a cui partecipare =( "]))],null,null)}function A(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,12,"ion-header",[],null,null,null,o.ab,o.o)),l["ɵdid"](1,49152,null,0,u.A,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](2,0,null,0,10,"ion-toolbar",[],null,null,null,o.xb,o.L)),l["ɵdid"](3,49152,null,0,u.yb,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](4,0,null,0,2,"ion-title",[],null,null,null,o.wb,o.K)),l["ɵdid"](5,49152,null,0,u.wb,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵted"](-1,0,["Elenco Cene"])),(n()(),l["ɵeld"](7,0,null,0,5,"ion-buttons",[["slot","primary"]],null,null,null,o.Q,o.e)),l["ɵdid"](8,49152,null,0,u.k,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](9,0,null,0,1,"rd-profile",[],null,null,null,m.b,m.a)),l["ɵdid"](10,114688,null,0,v.a,[D.a],null,null),(n()(),l["ɵand"](16777216,null,0,1,null,_)),l["ɵdid"](12,16384,null,0,s.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),l["ɵeld"](13,0,null,null,13,"ion-content",[["class","padding"]],null,null,null,o.W,o.k)),l["ɵdid"](14,49152,null,0,u.t,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](15,0,null,0,3,"ion-refresher",[["slot","fixed"]],null,[[null,"ionRefresh"]],(function(n,e,t){var l=!0;return"ionRefresh"===e&&(l=!1!==n.component.loadDinners(t)&&l),l}),o.lb,o.y)),l["ɵdid"](16,49152,null,0,u.Z,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],null,null),(n()(),l["ɵeld"](17,0,null,0,1,"ion-refresher-content",[["pullingIcon","lines"],["refreshingSpinner","lines"]],null,null,null,o.kb,o.z)),l["ɵdid"](18,49152,null,0,u.ab,[l.ChangeDetectorRef,l.ElementRef,l.NgZone],{pullingIcon:[0,"pullingIcon"],refreshingSpinner:[1,"refreshingSpinner"]},null),(n()(),l["ɵand"](16777216,null,0,1,null,w)),l["ɵdid"](20,16384,null,0,s.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),l["ɵand"](16777216,null,0,1,null,I)),l["ɵdid"](22,16384,null,0,s.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),l["ɵand"](16777216,null,0,1,null,N)),l["ɵdid"](24,16384,null,0,s.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),l["ɵand"](16777216,null,0,1,null,S)),l["ɵdid"](26,16384,null,0,s.NgIf,[l.ViewContainerRef,l.TemplateRef],{ngIf:[0,"ngIf"]},null)],(function(n,e){var t=e.component;n(e,10,0),n(e,12,0,t.paramsService.getParams().groupId&&!t.paramsService.getParams().dinnerId),n(e,18,0,"lines","lines"),n(e,20,0,!t.myDinner),n(e,22,0,t.myDinner),n(e,24,0,t.dinnerList&&t.dinnerList.length>0),n(e,26,0,!(t.myDinner||t.dinnerList&&t.dinnerList.length))}),null)}function T(n){return l["ɵvid"](0,[(n()(),l["ɵeld"](0,0,null,null,1,"app-dinners",[],null,null,null,A,C)),l["ɵdid"](1,114688,null,0,R,[D.a,y.a,a.n,b.a],null,null)],(function(n,e){n(e,1,0)}),null)}var L=l["ɵccf"]("app-dinners",R,T,{},{},[]),Z=t("gIcY"),k=function(){return t.e(104).then(t.bind(null,"eEW1")).then((function(n){return n.CreateDinnerPageModuleNgFactory}))},M=function(){return t.e(105).then(t.bind(null,"+q2n")).then((function(n){return n.DinnerDetailPageModuleNgFactory}))},P=function(){return function(){}}(),j=t("RnAK"),F=t("E9nr");t.d(e,"DinnersPageModuleNgFactory",(function(){return O}));var O=l["ɵcmf"](i,[],(function(n){return l["ɵmod"]([l["ɵmpd"](512,l.ComponentFactoryResolver,l["ɵCodegenComponentFactoryResolver"],[[8,[r.a,L]],[3,l.ComponentFactoryResolver],l.NgModuleRef]),l["ɵmpd"](4608,s.NgLocalization,s.NgLocaleLocalization,[l.LOCALE_ID,[2,s["ɵangular_packages_common_common_a"]]]),l["ɵmpd"](4608,Z.l,Z.l,[]),l["ɵmpd"](4608,u.b,u.b,[l.NgZone,l.ApplicationRef]),l["ɵmpd"](4608,u.Db,u.Db,[u.b,l.ComponentFactoryResolver,l.Injector]),l["ɵmpd"](4608,u.Gb,u.Gb,[u.b,l.ComponentFactoryResolver,l.Injector]),l["ɵmpd"](1073742336,s.CommonModule,s.CommonModule,[]),l["ɵmpd"](1073742336,Z.k,Z.k,[]),l["ɵmpd"](1073742336,Z.b,Z.b,[]),l["ɵmpd"](1073742336,u.Ab,u.Ab,[]),l["ɵmpd"](1073742336,a.p,a.p,[[2,a.u],[2,a.n]]),l["ɵmpd"](1073742336,P,P,[]),l["ɵmpd"](1073742336,j.a,j.a,[]),l["ɵmpd"](1073742336,F.a,F.a,[]),l["ɵmpd"](1073742336,i,i,[]),l["ɵmpd"](1024,a.l,(function(){return[[{path:"",component:R},{path:"create-dinner",loadChildren:k},{path:"dinner-detail",loadChildren:M}]]}),[])])}))}}]);